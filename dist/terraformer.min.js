/*! Terraformer JS - 0.0.1 - 2012-12-29
*   https://github.com/geoloqi/Terraformer
*   Copyright (c) 2012 Environmental Systems Research Institute, Inc.
*   Licensed MIT */
(function(e,t){typeof module=="object"&&typeof module.exports=="object"?exports=module.exports=t():typeof define=="function"&&define.amd?define(t):e.Terraformer=t(),typeof jasmine=="object"&&(e.Terraformer=t())})(this,function(){function o(e){return e*n}function u(e){return e*r}function a(e,t){for(var n=0;n<e.geometries.length;n++)e.geometries[n].geometry=l(e.features[n].geometry,t);return e}function f(e,t){for(var n=0;n<e.features.length;n++)e.features[n].geometry=l(e.features[n].geometry,t);return e}function l(e,t){for(var n=0;n<e.length;n++)typeof e[n][0]=="number"&&(e[n]=t(e[n])),typeof e[n]=="object"&&(e[n]=l(e[n],t));return e}function c(e){var n=e[0],r=e[1];return[o(n/t)-Math.floor((o(n/t)+180)/360)*360,o(Math.PI/2-2*Math.atan(Math.exp(-1*r/t)))]}function h(e){var n=e[0],r=Math.max(Math.min(e[1],89.99999),-89.99999);return[u(n)*t,t/2*Math.log((1+Math.sin(u(r)))/(1-Math.sin(u(r))))]}function p(e){var t=[],n;for(var r=0;r<e.length;r++){n=e[r];if(n.length>1)for(var i=0;i<n.length;i++)t.push(n[i]);else t.push(n[0])}return t}function d(e){if(e.coordinates&&e.type){if(e.type==="Point")return"Point";if(e.type==="LineString")return"LineString";if(e.type==="Polygon")return"Polygon";if(e.type==="MultiPoint")return"MultiPoint";if(e.type==="MultiLineString")return"MultiLineString";if(e.type==="MultiPolygon")return"MultiPolygon";if(e.type==="Feature")return"Feature";throw"Terraformer: invalid GeoJSON object. Are you sure your data is properly formatted?"}if(e.spatialReference){if(e.x&&e.y)return"Point";if(e.points)return"MultiPoint";if(e.paths)return e.paths.length===1?"LineString":"MultiLineString";if(e.rings)return e.rings.length===1?"Polygon":"MultiPolygon";throw"Terraformer: invalid ArcGIS input. Are you sure your data is properly formatted?"}throw"Terraformer: data is not a valid ArcGIS or GeoJSON object"}function v(e,t){return e.type==="Point"?e.coordinates=t(e.coordinates):e.type==="Feature"?e.geometry=v(e,t):e.type==="FeatureCollection"?e.features=f(e,t):e.type==="GeometryCollection"?e.geometries=a(e,t):e.coordinates=l(e.coordinates,t),t===h&&(e.crs=i),t===c&&(e.crs=s),e}var e={},t=6378137,n=57.29577951308232,r=.017453292519943,i={type:"link",properties:{href:"http://spatialreference.org/ref/sr-org/6928/ogcwkt/",type:"ogcwkt"}},s={type:"link",properties:{href:"http://spatialreference.org/ref/epsg/4326/ogcwkt/",type:"ogcwkt"}},m=function(e){return v(e,h)},g=function(e){return v(e,c)},y=function(e){var t=d(e),n={type:t};switch(t){case"Point":n.coordinates=[e.x,e.y];break;case"MultiPoint":n.coordinates=e.points;break;case"LineString":n.coordinates=e.paths[0];break;case"MultiLineString":n.coordinates=e.paths;break;case"Polygon":n.coordinates=e.rings;break;case"MultiPolygon":n.coordinates=e.rings}return e.spatialReference.wkid===102100&&(n.crs=i),n},b=function(e,t){var n=d(e),r={spatialReference:t||{wkid:4326}};n==="Feature"&&(e=e.geometry,n=d(e));switch(n){case"Point":r.x=e.coordinates[0],r.y=e.coordinates[1];break;case"MultiPoint":r.points=e.coordinates;break;case"LineString":r.paths=[e.coordinates];break;case"MultiLineString":r.paths=e.coordinates;break;case"Polygon":r.rings=e.coordinates;break;case"MultiPolygon":r.rings=p(e.coordinates)}return r};return e.toArcGIS=b,e.toGeoJSON=y,e.toMercator=m,e.toGeographic=g,e});